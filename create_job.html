<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create a Job</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">

    <!-- Vue.js -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet"/>
    <!-- MDB
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.2.0/mdb.min.css"rel="stylesheet"/>  -->

    <link rel="stylesheet" href="job_create.css">
</head>
<body onload="updateTime()" id="page_body">
    
    <div class="container" id="app">

        <div class="row">
            <!-- Form -->
            <div class="col bg-light bg-opacity-50">

                <h1 class="text-center my-3">Create New Job</h1>

                <label for="job_title" class="fw-bold">Enter Job Title</label>
                <input type="text" class="form-control" name="job_title" id="job_title">

                <!-- Job Description -->
                <div class="form-floating my-3">
                    <textarea class="form-control" id="job_desc"></textarea>
                    <label for="job_desc">Enter Job Description...</label>
                </div>


                <div class="row">
                    <!-- Start Date & Time -->
                    <div class="col">
                        <label for="appointment-time" style="font-weight: bold;">Select Start Date and Time:</label>
                        <input type="datetime-local" id="start-time" name="start-time" value="2018-06-12T19:30"
                        min="2018-06-07T00:00" max="2053-12-31T23:59">
                    </div>

                    <!-- End Date & Time -->
                    <div class="col">
                        <label for="appointment-time" style="font-weight: bold;">Select End Date and Time:</label>
                        <input type="datetime-local" id="end-time" name="end-time" value="2018-06-12T19:30"
                        min="2018-06-07T00:00" max="2053-12-31T23:59">
                    </div>
                </div>

                <div class="row">
                    <!-- Pay Rate -->
                    <div class="col">
                        <label for="payrate" style="font-weight: bold;">Select Pay Rate:</label>
                        <input type="number" class="form-control" name="payrate" id="payrate">
                    </div>
                </div>

                <!-- Pet Selection -->
                <div class="mt-3">
                    <label for="pets" class="fw-bold">Select Pets:</label>
                    <ul class="list-group" id="pets">
                        <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" value="dog" id="dog">
                            <label class="form-check-label">Dog</label>
                        </li>
                        <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" value="cat" id="cat">
                            <label class="form-check-label">Cat</label>
                        </li>
                        <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" value="rabbit" id="rabbit">
                            <label class="form-check-label">Rabbit</label>
                        </li>
                        <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" value="bird" id="bird">
                            <label class="form-check-label">Bird</label>
                        </li>
                        <li class="list-group-item">
                            <input class="form-check-input me-1" type="checkbox" value="turtle" id="turtle">
                            <label class="form-check-label">Turtle</label>
                        </li>
                        
                    </ul>
                </div>

                
                <!-- Specifications -->
                <div class="row align-items-center text-center">
                    <div class="col">
                        <label for="specifications" class="form-label fw-bold">Enter Specifications</label>
                        <div class="d-flex">
                            <input class="form-control" type="text" placeholder="Any Requirements?" id="specification" v-model="spec_text">
                            <button class="btn btn-success mx-2" @click="enterSpec()" :disabled="spec_text.length==0" >Enter</button>
                        </div>
                    </div>
                    <div class="col">
                        <strong>Current Specifications</strong>
                        <div id="curr_specs">
                            <p id="spec_placeholder">No Specifications Entered<p>
                            <ul class="list-group d-none" id="spec_list">
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Upload files -->
                <div class="my-3">
                    <label for="formFileMultiple" class="form-label" style="font-weight: bold;">Upload Relevant Images and File</label>
                    <input class="form-control" type="file" id="formFileMultiple" multiple>
                </div>

                <div class="d-grid gap-2 my-5">
                    <button class="btn btn-primary" type="button" onclick="submit_job()">Submit Job</button>
                </div>
            </div>


            <!-- Textbox  -->
            <div class="col" style="margin-left: 150px; margin-top: 150px;">
                <span class="display-4" style="color: aquamarine; font-weight: 400;">Find a Pet Sitter Today</span>
                <p class="fs-4 text-light fw-bold">We know that finding a pet sitter is hard, but we are here to make the job easier for you. Create your first job listing with us and let us handle the rest.</p>
            </div>
        </div>
    </div>





    <!-- Vue -->
    <script>
        const app = Vue.createApp({
        data() {
            return {
                spec_text: ''
            }
        },
        methods:{
            enterSpec(){
                document.getElementById("spec_placeholder").innerText = ""
                var spec_list = document.getElementById("spec_list")
                var curr_spec = document.getElementById("specification").value
                spec_list.setAttribute("class", "list-group")
                spec_list.innerHTML += 
                `<li class="list-group-item d-flex justify-content-between align-items-center" id="${curr_spec}">
                    ${curr_spec}
                <button class="btn btn-danger" onclick="removeSpec('${curr_spec}')">X</button>
                </li>`
                document.getElementById("specification").value = ""

                this.spec_text = ""
            }
        }
        })

        const vm = app.mount('#app')
        function updateTime() {
            const date = new Date()
            var year = date.getFullYear()
            var month = date.getMonth() + 1
            var day = date.getDate()
            var hours = date.getHours();
            var min = date.getMinutes();

            if (month < 10) {
                month = "0" + month
            }

            if (day < 10) {
                day = "0" + day
            }

            if (hours < 10) {
                hours = "0" + hours
            }

            if (min < 10) {
                min = "0" + min
            }

            document.getElementById("start-time").value = `${year}-${month}-${day}T${hours}:${min}`

            document.getElementById("start-time").min = `${year}-${month}-${day}T${hours}:${min}`

            document.getElementById("end-time").value = `${year}-${month}-${day}T${hours}:${min}`

            document.getElementById("end-time").min = `${year}-${month}-${day}T${hours}:${min}`
        }

        function removeSpec(spec) {
            document.getElementById(spec).remove()
            ifEmpty();
        }

        function ifEmpty() {
            var spec_list = document.getElementById("spec_list")
            if (spec_list.getElementsByTagName("li").length == 0) {
                document.getElementById("spec_placeholder").innerText = "No Specifications Entered"
                console.log(document.getElementById("spec_placeholder"));
                spec_list.setAttribute("class", "list-group d-none")
            }
        }
    </script>

    <script>

        function string_out(date_str) {
            return_arr = [];
            year = date_str.substring(0,4);
            month = date_str.substring(5,7);
            day = date_str.substring(8,10);
            hour = date_str.substring(11,13);
            minute = date_str.substring(15,17)

            return_arr.push(year)
            return_arr.push(month)
            return_arr.push(day)
            return_arr.push(hour)
            return_arr.push(minute)
            return_arr.push(0)

            // console.log(return_arr);

            return return_arr
        }

        function toTimestamp(year,month,day,hour,minute,second){
            var datum = new Date(Date.UTC(year,month-1,day,hour,minute,second));
            // console.log(datum);
            return datum.getTime()/1000;
        }

        const test_route = "http://localhost:5100/createjob"

        function submit_job() {

            var job_title = document.getElementById("job_title").value;
            var job_desc = document.getElementById("job_desc").value;
            

            var start_time_raw = document.getElementById("start-time").value;
            var end_time_raw = document.getElementById("end-time").value;

            var start_time_arr = string_out(start_time_raw);
            var start_time_unix = toTimestamp(start_time_arr[0],start_time_arr[1],start_time_arr[2],start_time_arr[3],start_time_arr[4],start_time_arr[5]);

            var end_time_arr = string_out(end_time_raw);
            var end_time_unix = toTimestamp(end_time_arr[0],end_time_arr[1],end_time_arr[2],end_time_arr[3],end_time_arr[4],end_time_arr[5]);


            var payrate  = document.getElementById("payrate").value;
            var pets = document.getElementById("pets");
            var pets_arr = []
            
            var spec_arr = [];
            var spec_list = document.getElementById("spec_list");
            var files = document.getElementById("formFileMultiple").value;


            var checkboxes = pets.getElementsByTagName("input");
            for(pet of checkboxes){
                if (pet.checked == true) {
                    pets_arr.push(pet.id);
                }
            }
            
            var specs = spec_list.getElementsByTagName("li");
            for(spec of specs){
                spec_arr.push(spec.id)
            }

            // console.log(start_time_unix);
            // console.log(end_time_unix);
            // console.log(payrate);
            // console.log(pets_arr);
            // console.log(job_desc);
            // console.log(spec_arr);
            // console.log(files);

            var image = "Pets/puppy.jpg"

            let jsonData = JSON.stringify({
                job_title : job_title,
                job_desc : job_desc,
                start_time : start_time_unix,
                end_time : end_time_unix,
                payrate : payrate,
                pets : pets_arr,
                spec_list : spec_arr,
                Image : image,
            })

            fetch(test_route,  {
                method : "POST",
                headers: {
                    "Content-type": "application/json"
                },
                body: jsonData
            })
            .then(response => response.json())
            .then(data => {
                console.log(data);
                result = data.data;
                console.log(result);
            })


        }
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
</body>
</html>